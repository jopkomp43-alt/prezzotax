import React, { useState, useEffect, useRef } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'firebase/auth';
import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from 'firebase/firestore';
import { Layout, Plus, Package, Sparkles, TrendingUp, Trash2, Camera, ChevronRight, Save, Info, Upload, X, Loader2, CheckCircle2, AlertCircle, Image as ImageIcon, Copy, ExternalLink, Eye, Globe, Edit3 } from 'lucide-react';

// --- Firebase Configuratie ---
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const appId = typeof __app_id !== 'undefined' ? __app_id : 'vinted-accelerator-v1';
const apiKey = ""; 

// Initialiseer Firebase
let app, auth, db;
try {
  app = initializeApp(firebaseConfig);
  auth = getAuth(app);
  db = getFirestore(app);
} catch (e) {
  console.error("Firebase init mislukt", e);
}

// --- Logo Component (Geïnspireerd op de geüploade afbeelding) ---
const PrezzotaxLogo = ({ size = 40, showText = true }) => (
  <div className="flex items-center gap-3">
    <div style={{ width: size, height: size }} className="relative flex items-center justify-center">
      <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        {/* Circle Border */}
        <circle cx="50" cy="50" r="48" stroke="#10b981" strokeWidth="0.5" strokeDasharray="4 4" opacity="0.3"/>
        {/* Cloud Shape */}
        <path d="M30 65C22 65 15 58 15 50C15 42 22 35 30 35C31 35 32 35 33 35.5C36 28 43 23 51 23C61 23 69 30 70.5 39.5C71.5 39 72.5 39 73.5 39C80.5 39 86 44.5 86 51.5C86 58.5 80.5 64 73.5 64L30 65Z" fill="#1e293b" />
        <path d="M30 62C23 62 18 57 18 50C18 43 23 38 30 38C31 38 32 38 33 38.5C36 32 43 27 51 27C60 27 67 33 68.5 41.5C69.5 41 70.5 41 71.5 41C77.5 41 82 45.5 82 51.5C82 57.5 77.5 62 71.5 62L30 62Z" fill="#0ea5e9" opacity="0.8" />
        {/* Hanger Shape */}
        <path d="M50 35C52 35 53 36 53 38C53 39 52 40 51 40L65 52C66 53 66 55 65 56C64 57 62 57 61 56L50 47L39 56C38 57 36 57 35 56C34 55 34 53 35 52L49 40C48 40 47 39 47 38C47 36 48 35 50 35Z" stroke="#fdba74" strokeWidth="2.5" strokeLinecap="round" />
        {/* Arrow Up */}
        <path d="M50 60V48M50 48L45 53M50 48L55 53" stroke="#22d3ee" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
      </svg>
    </div>
    {showText && (
      <div className="flex flex-col">
        <span className="font-black text-2xl tracking-tighter leading-none text-slate-900 uppercase italic">
          prezzo<span className="text-cyan-500">tax</span>
        </span>
        <span className="text-[7px] font-bold text-slate-400 uppercase tracking-[0.1em] mt-0.5">Your Style. Your Story.</span>
      </div>
    )}
  </div>
);

const compressImage = (base64Str, maxWidth = 800, maxHeight = 800) => {
  return new Promise((resolve) => {
    const img = new Image();
    img.src = base64Str;
    img.onload = () => {
      const canvas = document.createElement('canvas');
      let width = img.width;
      let height = img.height;
      if (width > height) {
        if (width > maxWidth) { height *= maxWidth / width; width = maxWidth; }
      } else {
        if (height > maxHeight) { width *= maxHeight / height; height = maxHeight; }
      }
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, width, height);
      resolve(canvas.toDataURL('image/jpeg', 0.7));
    };
  });
};

const App = () => {
  const [user, setUser] = useState(null);
  const [inventory, setInventory] = useState([]);
  const [isAdding, setIsAdding] = useState(false);
  const [viewMode, setViewMode] = useState('edit'); 
  const [loading, setLoading] = useState(false);
  const [saveStatus, setSaveStatus] = useState('idle'); 
  const [activeTab, setActiveTab] = useState('overzicht');
  const [selectedItem, setSelectedItem] = useState(null);
  const fileInputRef = useRef(null);

  const [formData, setFormData] = useState({
    title: '', category: 'Kleding', brand: '', size: '', color: '', material: '',
    condition: 'Heel goed', targetPrice: '', description_nl: '', description_en: '',
    description_fr: '', hashtags: '', images: [], aiSuggestions: null
  });

  useEffect(() => {
    if (!auth) return;
    const initAuth = async () => {
      try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          await signInAnonymously(auth);
        }
      } catch (e) { console.error("Auth error", e); }
    };
    initAuth();
    const unsubscribe = onAuthStateChanged(auth, setUser);
    return () => unsubscribe();
  }, []);

  useEffect(() => {
    if (!user || !db) return;
    const q = collection(db, 'artifacts', appId, 'public', 'data', 'inventory');
    const unsubscribe = onSnapshot(q, (snapshot) => {
      const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      setInventory(items.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)));
    });
    return () => unsubscribe();
  }, [user]);

  const handleImageChange = async (e) => {
    const files = Array.from(e.target.files);
    if (files.length === 0) return;
    setLoading(true);
    
    const firstFile = files[0];
    const reader = new FileReader();
    const firstFileData = await new Promise((res) => {
      reader.onloadend = () => res(reader.result);
      reader.readAsDataURL(firstFile);
    });
    const firstCompressed = await compressImage(firstFileData);
    
    analyzeFirstImage(firstCompressed);

    const allProcessedImages = [];
    for (let file of files) {
      const r = new FileReader();
      const data = await new Promise((res) => {
        r.onloadend = () => res(r.result);
        r.readAsDataURL(file);
      });
      const comp = await compressImage(data);
      allProcessedImages.push(comp);
    }

    setFormData(prev => ({ ...prev, images: [...prev.images, ...allProcessedImages] }));
    setLoading(false);
  };

  const removeImage = (index) => {
    setFormData(prev => ({ ...prev, images: prev.images.filter((_, i) => i !== index) }));
  };

  const analyzeFirstImage = async (base64Image) => {
    if (!base64Image) return;
    setLoading(true);
    const base64Data = base64Image.split(',')[1];
    
    const prompt = `Je bent een internationale verkoop expert voor het platform Prezzotax. Analyseer deze foto.
    Genereer verkoopteksten in NL, EN, FR.
    STRIPTE REGELS: 
    1. Verwerk de MAAT altijd in de TITEL (bijv: "Nike Sneakers - Maat 44").
    2. Als merkloos, brand leeg laten (""). NOOIT "Merkloos" invullen.
    3. Zet hashtags onder de Franse tekst.
    Reageer ALLEEN met JSON: {"title": "...", "brand": "...", "size": "...", "color": "...", "material": "...", "category": "...", "condition": "...", "description_nl": "...", "description_en": "...", "description_fr": "...", "hashtags": "...", "suggestedPrice": 0.00}`;

    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ role: "user", parts: [{ text: prompt }, { inlineData: { mimeType: "image/jpeg", data: base64Data } }] }],
          generationConfig: { responseMimeType: "application/json" }
        })
      });
      
      const result = await response.json();
      const ai = JSON.parse(result.candidates[0].content.parts[0].text.replace(/```json/g, '').replace(/```/g, '').trim());
      
      const brandCleaned = (ai.brand && !['merkloos', 'vintage', 'onbekend', 'none'].includes(ai.brand.toLowerCase())) ? ai.brand : '';

      setFormData(prev => ({
        ...prev, ...ai, brand: brandCleaned,
        targetPrice: ai.suggestedPrice ? ai.suggestedPrice.toString() : prev.targetPrice,
        aiSuggestions: ai
      }));
    } catch (error) { console.error("AI Error", error); } finally { setLoading(false); }
  };

  const handleSave = async () => {
    if (!user || !db) return;
    setSaveStatus('saving');
    try {
      const payload = { ...formData, userId: user.uid, updatedAt: new Date().toISOString() };
      if (selectedItem) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'inventory', selectedItem.id), payload);
      else await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'inventory'), payload);
      
      setSaveStatus('success');
      setTimeout(() => { setIsAdding(false); setSelectedItem(null); setSaveStatus('idle'); resetForm(); setActiveTab('magazijn'); }, 1000);
    } catch (e) { setSaveStatus('error'); }
  };

  const resetForm = () => {
    setFormData({ title: '', category: 'Kleding', brand: '', size: '', color: '', material: '', condition: 'Heel goed', targetPrice: '', description_nl: '', description_en: '', description_fr: '', hashtags: '', images: [], aiSuggestions: null });
  };

  const copyToClipboard = (text) => {
    const el = document.createElement('textarea');
    el.value = text;
    document.body.appendChild(el);
    el.select();
    document.execCommand('copy');
    document.body.removeChild(el);
  };

  const handleDelete = async (e, id) => {
    e.stopPropagation();
    if (db) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'inventory', id));
  };

  const getFullDescription = () => {
    return `[NEDERLANDS]\n${formData.description_nl}\n\n[ENGLISH]\n${formData.description_en}\n\n[FRANÇAIS]\n${formData.description_fr}\n\n${formData.hashtags}`;
  };

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900 font-sans pb-28">
      {/* Header met nieuw logo */}
      <header className="bg-white/90 backdrop-blur-md border-b border-slate-200 sticky top-0 z-40">
        <div className="max-w-6xl mx-auto px-6 h-20 flex items-center justify-between">
          <PrezzotaxLogo />
          <button 
            onClick={() => { setIsAdding(true); setViewMode('edit'); resetForm(); }}
            className="bg-slate-900 hover:bg-slate-800 text-white px-6 py-3 rounded-2xl font-black transition-all flex items-center gap-2 shadow-xl active:scale-95"
          >
            <Plus size={20} className="text-cyan-400" /> <span className="hidden sm:inline">Nieuw Item</span>
          </button>
        </div>
      </header>

      <main className="max-w-6xl mx-auto px-6 py-10">
        {activeTab === 'overzicht' ? (
          <div className="space-y-12 animate-in fade-in duration-700">
            {/* Dashboard Stats */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
              <div className="bg-white p-10 rounded-[3rem] border border-slate-100 shadow-sm hover:border-cyan-200 transition-all">
                <div className="text-slate-400 text-[10px] font-black uppercase tracking-widest mb-4">Winstprognose</div>
                <div className="text-5xl font-black text-cyan-600">€{inventory.reduce((acc, curr) => acc + (parseFloat(curr.targetPrice) || 0), 0).toFixed(0)}</div>
              </div>
              <div className="bg-white p-10 rounded-[3rem] border border-slate-100 shadow-sm">
                <div className="text-slate-400 text-[10px] font-black uppercase tracking-widest mb-4">Gescande Items</div>
                <div className="text-5xl font-black text-slate-900">{inventory.length}</div>
              </div>
              <div className="bg-slate-900 p-10 rounded-[3rem] text-white shadow-2xl flex items-center justify-between overflow-hidden relative">
                <div className="relative z-10 text-left">
                  <div className="text-cyan-400 text-[10px] font-black uppercase tracking-widest mb-4">Engine Status</div>
                  <div className="text-4xl font-black">PREZZO V4</div>
                </div>
                <Sparkles size={100} className="absolute -right-6 text-slate-800 opacity-50 rotate-12" />
              </div>
            </div>

            {/* Logo Landing Area */}
            <div className="bg-slate-900 rounded-[4rem] p-12 text-white flex flex-col md:flex-row items-center gap-12 shadow-2xl relative overflow-hidden group">
              <div className="absolute top-0 right-0 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl -mr-32 -mt-32"></div>
              <div className="relative z-10 w-48 h-48 bg-white/5 backdrop-blur-sm rounded-[3rem] p-8 flex items-center justify-center border border-white/10 group-hover:scale-105 transition-transform duration-500">
                <PrezzotaxLogo size={120} showText={false} />
              </div>
              <div className="text-center md:text-left flex-1 relative z-10">
                <h2 className="text-4xl font-black mb-4 tracking-tight italic">UPLOAD & DISCOVER</h2>
                <p className="text-slate-300 text-xl font-medium opacity-80 leading-relaxed max-w-2xl">
                  Welkom bij het officiële **Prezzotax** dashboard. Maak een foto, laat de AI het internationale werk doen en verkoop 3x sneller op de Europese markt.
                </p>
                <button onClick={() => setIsAdding(true)} className="mt-8 bg-cyan-500 text-slate-900 px-10 py-5 rounded-[2rem] font-black hover:bg-cyan-400 transition-all flex items-center gap-3 mx-auto md:mx-0 shadow-xl shadow-cyan-500/20">
                  Direct Uploaden <ChevronRight size={24} />
                </button>
              </div>
            </div>
          </div>
        ) : (
          <div className="space-y-10 animate-in slide-in-from-bottom-10 duration-500">
            <h2 className="text-4xl font-black flex items-center gap-5 italic tracking-tighter text-slate-900 uppercase">
              <Package className="text-cyan-500" size={40} /> Voorraadbeheer
            </h2>
            
            {inventory.length === 0 ? (
              <div className="bg-white border-4 border-dashed border-slate-100 rounded-[4rem] p-32 text-center flex flex-col items-center">
                <div className="opacity-20 mb-8 scale-150"><PrezzotaxLogo size={80} showText={false} /></div>
                <h3 className="text-3xl font-black text-slate-400 mb-4 tracking-tight italic">Uw kast wacht op AI optimalisatie...</h3>
                <button onClick={() => setIsAdding(true)} className="bg-slate-900 text-white px-10 py-5 rounded-[2rem] font-black shadow-lg">Voeg item toe</button>
              </div>
            ) : (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                {inventory.map((item) => (
                  <div key={item.id} className="bg-white rounded-[3.5rem] border border-slate-100 overflow-hidden hover:shadow-3xl hover:-translate-y-4 transition-all duration-700 group flex flex-col shadow-sm">
                    <div className="h-72 relative overflow-hidden bg-slate-50">
                      {item.images && item.images.length > 0 && (
                        <img src={item.images[0]} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000" alt={item.title} />
                      )}
                      <div className="absolute top-8 left-8 bg-slate-900/95 backdrop-blur-md px-5 py-2 rounded-2xl text-[11px] font-black uppercase tracking-widest text-cyan-400 shadow-xl">
                        {item.brand || 'No Brand'}
                      </div>
                      <div className="absolute top-8 right-8 flex gap-2">
                        <button onClick={(e) => { e.stopPropagation(); setSelectedItem(item); setFormData(item); setIsAdding(true); setViewMode('preview'); }} className="p-4 bg-white/90 backdrop-blur-md text-slate-900 rounded-3xl opacity-0 group-hover:opacity-100 transition-all hover:bg-slate-100 shadow-2xl"><Eye size={24} /></button>
                        <button onClick={(e) => handleDelete(e, item.id)} className="p-4 bg-red-500 text-white rounded-3xl opacity-0 group-hover:opacity-100 transition-all hover:bg-red-600 shadow-2xl shadow-red-200"><Trash2 size={24} /></button>
                      </div>
                      <div className="absolute bottom-8 left-8 bg-slate-900/80 backdrop-blur-md text-white px-5 py-2 rounded-2xl text-[12px] font-black uppercase tracking-widest border border-cyan-500/30">€{item.targetPrice}</div>
                    </div>
                    <div className="p-10 flex-1 flex flex-col">
                      <h3 className="font-black text-2xl mb-4 line-clamp-1 text-slate-900 uppercase tracking-tighter italic">{item.title}</h3>
                      <div className="mt-auto grid grid-cols-2 gap-4 pt-8 border-t border-slate-50">
                        <button onClick={() => { setSelectedItem(item); setFormData(item); setIsAdding(true); setViewMode('edit'); }} className="py-4 rounded-2xl font-black text-sm bg-slate-100 hover:bg-slate-200 transition-all text-slate-900">Bewerken</button>
                        <button onClick={() => { setSelectedItem(item); setFormData(item); setIsAdding(true); setViewMode('preview'); }} className="py-4 rounded-2xl font-black text-sm bg-slate-900 text-white hover:bg-slate-800 transition-all shadow-md">Bekijk Preview</button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}
      </main>

      {isAdding && (
        <div className="fixed inset-0 bg-slate-950/95 backdrop-blur-3xl z-50 flex items-center justify-center p-4">
          <div className="bg-white w-full max-w-6xl rounded-[4.5rem] overflow-hidden shadow-2xl flex flex-col max-h-[95vh] animate-in zoom-in-95 duration-500 relative">
            <button onClick={() => setIsAdding(false)} className="absolute top-12 right-12 z-20 bg-slate-100 p-5 rounded-full hover:bg-slate-200 transition-colors text-slate-900"><X size={32} /></button>

            <div className="p-16 pb-10 flex items-center gap-10 border-b border-slate-50">
              <button onClick={() => setViewMode('edit')} className={`text-4xl font-black tracking-tight transition-all flex items-center gap-3 ${viewMode === 'edit' ? 'text-slate-900 underline decoration-cyan-400 underline-offset-8' : 'text-slate-300 hover:text-slate-400'}`}>
                <Edit3 size={32} /> Formulier
              </button>
              <button onClick={() => setViewMode('preview')} className={`text-4xl font-black tracking-tight transition-all flex items-center gap-3 ${viewMode === 'preview' ? 'text-slate-900 underline decoration-cyan-400 underline-offset-8' : 'text-slate-300 hover:text-slate-400'}`}>
                <Eye size={32} /> Preview
              </button>
            </div>

            <div className="p-16 overflow-y-auto space-y-16">
              {viewMode === 'edit' ? (
                <div className="space-y-16">
                  <div className="space-y-8 text-center">
                    <h4 className="text-[12px] font-black uppercase tracking-[0.2em] text-slate-300">Galerij</h4>
                    <div className="grid grid-cols-2 sm:grid-cols-5 gap-6">
                      {formData.images.map((img, idx) => (
                        <div key={idx} className="aspect-square rounded-[2.5rem] overflow-hidden relative group bg-slate-50 border-2 border-slate-100 shadow-sm">
                          <img src={img} className="w-full h-full object-cover" alt="" />
                          <button onClick={() => removeImage(idx)} className="absolute top-4 right-4 p-2 bg-white/90 backdrop-blur-md text-red-500 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity"><X size={16} /></button>
                        </div>
                      ))}
                      {formData.images.length < 10 && (
                        <button onClick={() => fileInputRef.current.click()} className="aspect-square rounded-[2.5rem] border-4 border-dashed border-slate-100 flex flex-col items-center justify-center text-slate-300 hover:border-cyan-200 hover:bg-cyan-50/20 transition-all group">
                          <Camera size={48} className="text-slate-300 group-hover:text-cyan-500 transition-colors" />
                        </button>
                      )}
                    </div>
                    <input type="file" ref={fileInputRef} onChange={handleImageChange} accept="image/*" multiple className="hidden" />
                    {loading && (
                      <div className="bg-slate-900 border border-slate-800 rounded-[2.5rem] p-10 flex flex-col items-center justify-center gap-4 animate-pulse">
                        <Loader2 className="animate-spin text-cyan-400" size={48} />
                        <div className="font-black text-cyan-400 text-sm uppercase tracking-[0.3em]">AI Analyseert Beeld...</div>
                      </div>
                    )}
                  </div>

                  <div className="space-y-10">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                      <div className="space-y-4">
                        <label className="text-[11px] font-black uppercase tracking-widest text-slate-400 ml-4">Titel (Maat incl.)</label>
                        <input type="text" value={formData.title} onChange={(e) => setFormData({...formData, title: e.target.value})} className="w-full px-8 py-6 rounded-[2rem] bg-slate-50 border-none font-black text-xl text-slate-900 focus:ring-4 focus:ring-cyan-100 transition-all shadow-inner" />
                      </div>
                      <div className="space-y-4">
                        <label className="text-[11px] font-black uppercase tracking-widest text-slate-400 ml-4">Merk (Leeg voor merkloos)</label>
                        <input type="text" value={formData.brand} placeholder="..." onChange={(e) => setFormData({...formData, brand: e.target.value})} className="w-full px-8 py-6 rounded-[2rem] bg-slate-50 border-none font-black text-xl text-slate-900 focus:ring-4 focus:ring-cyan-100 transition-all shadow-inner" />
                      </div>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                      {['size', 'color', 'material', 'targetPrice'].map((key) => (
                        <div key={key} className="space-y-4">
                          <label className="text-[11px] font-black uppercase tracking-widest text-slate-400 ml-4 capitalize">{key === 'targetPrice' ? 'Prijs (€)' : key === 'size' ? 'Maat' : key}</label>
                          <input type="text" value={formData[key]} onChange={(e) => setFormData({...formData, [key]: e.target.value})} className={`w-full px-8 py-6 rounded-[2rem] bg-slate-50 border-none font-black text-center ${key === 'targetPrice' ? 'text-emerald-600 bg-emerald-50' : 'text-slate-900'}`} />
                        </div>
                      ))}
                    </div>
                    <div className="space-y-4">
                      <label className="text-[11px] font-black uppercase tracking-widest text-slate-400 ml-4 text-slate-400">Hashtags</label>
                      <input type="text" value={formData.hashtags} onChange={(e) => setFormData({...formData, hashtags: e.target.value})} className="w-full px-8 py-6 rounded-[2rem] bg-slate-900 border-none font-bold text-cyan-400 shadow-xl" />
                    </div>
                    <div className="grid grid-cols-1 gap-12 text-slate-900">
                      <textarea rows="4" value={formData.description_nl} onChange={(e) => setFormData({...formData, description_nl: e.target.value})} className="w-full px-8 py-6 rounded-[2rem] bg-slate-50 border-none font-medium leading-relaxed" placeholder="NL Beschrijving" />
                      <textarea rows="4" value={formData.description_en} onChange={(e) => setFormData({...formData, description_en: e.target.value})} className="w-full px-8 py-6 rounded-[2rem] bg-slate-50 border-none font-medium leading-relaxed" placeholder="EN Description" />
                      <textarea rows="4" value={formData.description_fr} onChange={(e) => setFormData({...formData, description_fr: e.target.value})} className="w-full px-8 py-6 rounded-[2rem] bg-slate-50 border-none font-medium leading-relaxed" placeholder="FR Description" />
                    </div>
                  </div>
                </div>
              ) : (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-16 animate-in fade-in duration-500 pb-10">
                  <div className="space-y-8">
                    <div className="aspect-[4/5] rounded-[3rem] overflow-hidden bg-slate-100 shadow-2xl relative">
                      {formData.images[0] && <img src={formData.images[0]} className="w-full h-full object-cover" alt="" />}
                      <div className="absolute top-6 left-6"><PrezzotaxLogo size={40} showText={false} /></div>
                    </div>
                    <div className="bg-white p-10 rounded-[3rem] border border-slate-100 shadow-sm space-y-6">
                       <div className="flex justify-between items-start">
                         <h3 className="text-3xl font-black text-slate-900 pr-4 italic uppercase">{formData.title}</h3>
                         <button onClick={() => copyToClipboard(formData.title)} className="bg-slate-100 p-3 rounded-2xl hover:bg-slate-200 text-slate-600 transition-all shadow-sm"><Copy size={20} /></button>
                       </div>
                       <div className="text-4xl font-black text-cyan-600 italic">€{formData.targetPrice}</div>
                    </div>
                  </div>

                  <div className="space-y-10">
                    <div className="bg-slate-900 p-10 rounded-[3.5rem] relative shadow-2xl border border-slate-800">
                      <div className="flex justify-between items-center mb-8">
                        <div className="flex items-center gap-3">
                           <PrezzotaxLogo size={32} showText={false} />
                           <h5 className="font-black text-slate-300 text-xs uppercase tracking-widest italic">Global Listing Block</h5>
                        </div>
                        <button 
                          onClick={() => copyToClipboard(getFullDescription())} 
                          className="bg-cyan-500 hover:bg-cyan-400 text-slate-900 flex items-center gap-2 px-6 py-3 rounded-2xl font-black text-xs uppercase tracking-widest transition-all shadow-xl shadow-cyan-500/30 active:scale-95"
                        >
                          <Copy size={16} /> <span>Kopieer Alles</span>
                        </button>
                      </div>
                      <textarea readOnly value={getFullDescription()} className="w-full h-[450px] bg-slate-800/50 border-none rounded-[2rem] p-8 text-slate-300 font-medium text-base leading-relaxed resize-none focus:ring-0 scrollbar-hide" />
                    </div>
                  </div>
                </div>
              )}
            </div>

            <div className="p-16 bg-slate-50 border-t border-slate-100 flex gap-8">
              <button onClick={handleSave} disabled={formData.images.length === 0 || saveStatus === 'saving'} className="flex-[2] bg-slate-900 hover:bg-slate-800 disabled:bg-slate-300 text-white font-black py-8 rounded-[2.5rem] flex items-center justify-center gap-5 transition-all shadow-3xl active:scale-95 text-2xl">
                {saveStatus === 'saving' ? <Loader2 className="animate-spin" size={32} /> : <><Save size={32} className="text-cyan-400" /> <span className="text-white">Product Opslaan</span></>}
              </button>
            </div>
          </div>
        </div>
      )}

      <nav className="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-900/95 backdrop-blur-3xl px-12 py-6 rounded-[3rem] flex items-center gap-16 z-50 shadow-2xl border border-slate-800/50">
        <button onClick={() => setActiveTab('overzicht')} className={`flex flex-col items-center gap-2 transition-all ${activeTab === 'overzicht' ? 'text-cyan-400 scale-125' : 'text-slate-500 hover:text-slate-400'}`}>
          <Layout size={28} /><span className="text-[9px] font-black uppercase tracking-[0.2em]">Dashboard</span>
        </button>
        <button onClick={() => setActiveTab('magazijn')} className={`flex flex-col items-center gap-2 transition-all ${activeTab === 'magazijn' ? 'text-cyan-400 scale-125' : 'text-slate-500 hover:text-slate-400'}`}>
          <Package size={28} /><span className="text-[9px] font-black uppercase tracking-[0.2em]">Voorraad</span>
        </button>
      </nav>
    </div>
  );
};

export default App;
